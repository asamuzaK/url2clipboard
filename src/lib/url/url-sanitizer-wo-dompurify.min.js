var{DOMPurify:B}=globalThis;var b=t=>Object.prototype.toString.call(t).slice(8,-1),d=t=>typeof t=="string"||t instanceof String;var z=[7,8,9,10,11,12,13,27,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];var G=["aaa","aaas","about","acap","acct","acd","acr","adiumxtra","adt","afp","afs","aim","amss","android","appdata","apt","ar","ark","attachment","aw","barion","beshare","bitcoin","bitcoincash","blob","bolo","browserext","cabal","calculator","callto","cap","cast","casts","chrome","chrome-extension","cid","coap","coaps","com-eventbrite-attendee","content","content-type","crid","cstr","cvs","dab","dat","data","dav","dhttp","diaspora","dict","did","dis","dlna-playcontainer","dlna-playsingle","dns","dntp","doi","dpp","drm","dtmi","dtn","dvb","dvx","dweb","ed2k","eid","elsi","embedded","ens","ethereum","example","facetime","feed","feedready","fido","file","finger","first-run-pen-experience","fish","fm","ftp","fuchsia-pkg","geo","gg","git","gitoid","gizmoproject","go","gopher","graph","gtalk","h323","ham","hcap","hcp","http","https","hxxp","hxxps","hydrazone","hyper","iax","icap","icon","im","imap","info","iotdisco","ipfs","ipn","ipns","ipp","ipps","irc","irc6","ircs","iris","iris.beep","iris.lwz","iris.xpc","iris.xpcs","isostore","itms","jabber","jar","jms","keyparc","lastfm","lbry","ldap","ldaps","leaptofrogans","lorawan","lpa","lvlt","magnet","mailto","maps","market","matrix","message","microsoft.windows.camera","microsoft.windows.camera.multipicker","microsoft.windows.camera.picker","mid","mms","mongodb","moz","moz-extension","ms-access","ms-appinstaller","ms-browser-extension","ms-calculator","ms-drive-to","ms-enrollment","ms-excel","ms-eyecontrolspeech","ms-gamebarservices","ms-gamingoverlay","ms-getoffice","ms-help","ms-infopath","ms-inputapp","ms-lockscreencomponent-config","ms-media-stream-id","ms-meetnow","ms-mixedrealitycapture","ms-mobileplans","ms-newsandinterests","ms-officeapp","ms-people","ms-powerpoint","ms-project","ms-publisher","ms-remotedesktop","ms-remotedesktop-launch","ms-restoretabcompanion","ms-screenclip","ms-screensketch","ms-search","ms-search-repair","ms-secondary-screen-controller","ms-secondary-screen-setup","ms-settings","ms-settings-airplanemode","ms-settings-bluetooth","ms-settings-camera","ms-settings-cellular","ms-settings-cloudstorage","ms-settings-connectabledevices","ms-settings-displays-topology","ms-settings-emailandaccounts","ms-settings-language","ms-settings-location","ms-settings-lock","ms-settings-nfctransactions","ms-settings-notifications","ms-settings-power","ms-settings-privacy","ms-settings-proximity","ms-settings-screenrotation","ms-settings-wifi","ms-settings-workplace","ms-spd","ms-stickers","ms-sttoverlay","ms-transit-to","ms-useractivityset","ms-virtualtouchpad","ms-visio","ms-walk-to","ms-whiteboard","ms-whiteboard-cmd","ms-word","msnim","msrp","msrps","mss","mt","mtqp","mumble","mupdate","mvn","news","nfs","ni","nih","nntp","notes","num","ocf","oid","onenote","onenote-cmd","opaquelocktoken","openpgp4fpr","otpauth","palm","paparazzi","payment","payto","pkcs11","platform","pop","pres","proxy","psyc","pttp","pwid","qb","query","quic-transport","redis","rediss","reload","res","resource","rmi","rsync","rtmfp","rtmp","rtsp","rtsps","rtspu","sarif","secondlife","secret-token","service","session","sftp","sgn","shc","sieve","simpleledger","simplex","sip","sips","skype","smb","smp","sms","smtp","snmp","soap.beep","soap.beeps","soldat","spiffe","spotify","ssb","ssh","starknet","steam","stun","stuns","submit","svn","swh","swid","swidpath","tag","taler","teamspeak","tel","teliaeid","telnet","tftp","things","thismessage","tip","tn3270","tool","turn","turns","tv","udp","unreal","urn","ut2004","uuid-in-package","v-event","vemmi","ventrilo","ves","view-source","vnc","vscode","vscode-insiders","vsls","w3","wcr","web3","webcal","wifi","ws","wss","wtai","wyciwyg","xcon","xcon-userid","xfire","xmlrpc.beep","xmlrpc.beeps","xmpp","xri","ymsgr","z39.50r","z39.50s"];var{FileReader:q}=globalThis;var U=16,te=/^[\w+/\-=]+$/,se=/:$/,re=/^\d+/,ae=/#x?$/,ie=/^#(?:x(?:00)?[2-7]|\d)/,oe=/^x[\dA-F]+/i,ne=/&#(x(?:00)?[\dA-F]{2}|0?\d{1,3});?/gi,ce=/^[a-z][\da-z+\-.]*$/,pe=/^(?:ext|web)\+[a-z]+$/,Y=/(?:java|vb)script/,le=/^%[\dA-F]{2}$/i,T=t=>{if(!d(t))throw new TypeError(`Expected String but got ${b(t)}.`);let e=[];for(let s of t)e.push(`%${s.charCodeAt(0).toString(U).toUpperCase()}`);return e.join("")},j=t=>{d(t)&&le.test(t)&&(t=t.toUpperCase());let[e,s,r,a,o,n]=["&","#","<",">",'"',"'"].map(T),i;return t===e?i=`${e}amp;`:t===r?i=`${e}lt;`:t===a?i=`${e}gt;`:t===o?i=`${e}quot;`:t===n?i=`${e}${s}39;`:i=t,i},X=t=>{if(d(t)){if(!te.test(t))throw new Error(`Invalid base64 data: ${t}`)}else throw new TypeError(`Expected String but got ${b(t)}.`);let e=atob(t),s=Uint8Array.from([...e].map(o=>o.charCodeAt(0))),r=new Set(z),a;return s.every(o=>r.has(o))?a=e.replace(/\s/g,T):a=t,a},M=(t,e=0)=>{if(!d(t))throw new TypeError(`Expected String but got ${b(t)}.`);if(Number.isInteger(e)){if(e>U)throw new Error("Character references nested too deeply.")}else throw new TypeError(`Expected Number but got ${b(e)}.`);let s=decodeURIComponent(t);if(/&#/.test(s)){let r=new Set(z),a=[...s.matchAll(ne)].reverse();for(let o of a){let[n,i]=o,p;if(oe.test(i)?p=parseInt(`0${i}`,U):re.test(i)&&(p=parseInt(i)),Number.isInteger(p)){let{index:u}=o,[l,f]=[s.substring(0,u),s.substring(u+n.length)];r.has(p)?(s=`${l}${String.fromCharCode(p)}${f}`,(ae.test(l)||ie.test(f))&&(s=M(s,++e))):p<U*U&&(s=`${l}${f}`)}}}return s},Q=t=>new Promise((e,s)=>{let r=new q;r.addEventListener("error",()=>s(r.error)),r.addEventListener("abort",()=>e(r.result)),r.addEventListener("load",()=>e(r.result)),r.readAsDataURL(t)}),A=class{#e;constructor(){this.#e=new Set(G)}get(){return[...this.#e]}has(e){return this.#e.has(e)}add(e){if(d(e)){if(Y.test(e)||!ce.test(e))throw new Error(`Invalid scheme: ${e}`)}else throw new TypeError(`Expected String but got ${b(e)}.`);return this.#e.add(e),[...this.#e]}remove(e){return this.#e.delete(e)}verify(e){let s;if(d(e))try{let{protocol:r}=new URL(e),a=r.replace(se,""),o=a.split("+");s=!Y.test(a)&&pe.test(a)||o.every(n=>this.#e.has(n))}catch{s=!1}return!!s}reset(){this.#e.clear();for(let e of G)this.#e.add(e)}};var me=16,O=/data:[\w#&+\-./;=]*,/,J=/data:[\w#&+\-./;=]*base64,[\w+/\-=]+/i,de=/data:[\w#&+\-./;=]*,[^"]+/g,v=/:$/,fe=/(?:#|%23)$/,he=/(?<!(?:#|%23).*)(?:\?|%3F)$/,ue=/[<>"'\s]/g,ge=/%(?:2(?:2|7)|3(?:C|E))/g,ye=/^(?:text\/(?:ht|x)ml|application\/(?:[\w#&\-.;]+\+)?xml|image\/svg\+xml)/,N=/(?:java|vb)script|blob/,K=/%(?:2(?:2|7)|3(?:C|E))|[<>"']/,be=/%26/g,I=class extends A{#e;#t;constructor(){super(),this.#e=0,this.#t=new Set}replace(e){if(!d(e))throw new TypeError(`Expected String but got ${b(e)}.`);let s=e;if(O.test(s)){let a=[...s.matchAll(de)].reverse();for(let o of a){let[n]=o;J.test(n)&&([n]=J.exec(n)),this.#e++,this.#t.add(n);let i=this.sanitize(n,{allow:["data"]}),{index:p}=o,[u,l]=[s.substring(0,p),s.substring(p+n.length)];i?s=`${u}${i}${l}`:s=`${u}${l}`}}return s}purify(e){if(!d(e))throw new TypeError(`Expected String but got ${b(e)}.`);let s=B.sanitize(decodeURIComponent(e));return s&&O.test(s)&&(s=this.replace(s)),s=s.replace(fe,"").replace(he,""),encodeURI(s)}sanitize(e,s){if(this.#e>me)throw this.#e=0,new Error("Data URLs nested too deeply.");let{allow:r,deny:a,only:o,remove:n}=s??{},i=new Map([["blob",!1],["data",!1],["file",!1],["javascrpt",!1],["vbscript",!1]]),p=new Set,u=!1;if(Array.isArray(o)&&o.length){let f=super.get();for(let m of f)i.set(m,!1);let c=Object.values(o);for(let m of c)if(d(m)&&(m=m.trim(),!N.test(m))){if(super.has(m))i.set(m,!0);else{try{super.add(m)}catch{}super.has(m)&&(i.set(m,!0),p.add(m))}!u&&i.has(m)&&(u=i.get(m))}}else{if(Array.isArray(r)&&r.length){let f=Object.values(r);for(let c of f)if(d(c)&&(c=c.trim(),!N.test(c)))if(super.has(c))i.set(c,!0);else{try{super.add(c)}catch{}super.has(c)&&(i.set(c,!0),p.add(c))}}if(Array.isArray(a)&&a.length){let f=Object.values(a);for(let c of f)d(c)&&(c=c.trim(),c&&i.set(c,!1))}}let l;if(super.verify(e)){let{hash:f,href:c,pathname:m,protocol:E,search:_}=new URL(e),C=E.replace(v,""),k=C.split("+"),L;if(u)L=k.every(y=>i.get(y));else for(let[y,x]of i.entries())if(L=x||C!==y&&k.every(h=>h!==y),!L)break;if(L){let y=k.includes("data"),x,h=c;if(y){let[R,...D]=m.split(","),S=`${D.join(",")}${_}${f}`,$=R.split(";"),P=$[$.length-1]==="base64",g=S;P&&(g=X(S));try{let H=M(g).trim(),{protocol:V}=new URL(H);V.replace(v,"").split("+").some(W=>N.test(W))&&(h="")}catch{}let F=O.test(g);g!==S||F?F?g=this.replace(g):this.#t.has(e)?this.#t.delete(e):x=!0:this.#t.has(e)?this.#t.delete(e):x=!0,(!R||ye.test(R))&&(g=this.purify(g)),h&&g?(P&&g!==S&&$.pop(),h=`${C}:${$.join(";")},${g}`):h=""}else x=!0;if(!y&&n&&K.test(h)){let R=K.exec(h),{index:D}=R;h=h.substring(0,D)}h?(l=h.replace(ue,T).replace(be,j),x&&(y||(l=l.replace(ge,j)),this.#e=0)):this.#e=0}p.size&&p.forEach(y=>{super.remove(y)})}return l||null}parse(e,s){if(!d(e))throw new TypeError(`Expected String but got ${b(e)}.`);let r=new Map([["input",e]]),a;if(this.verify(e)){let{protocol:o}=new URL(e);o==="blob:"?a=e:a=this.sanitize(e,s??{allow:["data","file"]})}if(a){let o=new URL(a),{pathname:n,protocol:i}=o,u=i.replace(v,"").split("+").includes("data");if(r.set("valid",!0),u){let l=new Map,[f,...c]=n.split(","),m=`${c.join(",")}`,E=f.split(";"),_=E[E.length-1]==="base64";_&&E.pop(),l.set("mime",E.join(";")),l.set("base64",_),l.set("data",m),r.set("data",Object.fromEntries(l))}else r.set("data",null);for(let l in o){let f=o[l];d(f)&&r.set(l,f)}}else r.set("valid",!1);return Object.fromEntries(r)}reset(){super.reset(),this.#e=0,this.#t.clear()}},w=new I,we=async(t,e={allow:[],deny:[],only:[]})=>{let s;if(t&&d(t)){let r;try{let{protocol:a}=new URL(t);r=a.replace(v,"")}catch{}if(r==="blob"){let{allow:a,deny:o,only:n}=e;if(Array.isArray(a)&&a.includes("blob")&&!(Array.isArray(o)&&o.includes("blob"))||Array.isArray(n)&&n.includes("blob")){let i;try{i=await fetch(t).then(p=>p.blob()).then(Q)}catch{}if(i){if(Array.isArray(n))n.includes("data")||n.push("data");else if(Array.isArray(a)&&(a.includes("data")||a.push("data"),Array.isArray(o)&&o.includes("data"))){let p=o.indexOf("data");o.splice(p,1)}s=w.sanitize(i,e)}}URL.revokeObjectURL(t)}else r&&(s=w.sanitize(t,e))}return s||null},Ee=(t,e)=>{let s;if(t&&d(t)){let r;try{let{protocol:a}=new URL(t);r=a.replace(v,"")}catch{}r==="blob"?URL.revokeObjectURL(t):r&&(s=w.sanitize(t,e))}return s||null},xe=async t=>w.parse(t),Re=t=>w.parse(t),Ue=async t=>w.verify(t),ve=t=>w.verify(t);export{w as default,Ue as isURI,ve as isURISync,xe as parseURL,Re as parseURLSync,we as sanitizeURL,Ee as sanitizeURLSync};
/*!
 * URL Sanitizer
 *
 * @license MIT
 * @copyright asamuzaK (Kazz)
 * @see {@link https://github.com/asamuzaK/urlSanitizer/blob/main/LICENSE}
 */
//# sourceMappingURL=url-sanitizer-wo-dompurify.min.js.map
